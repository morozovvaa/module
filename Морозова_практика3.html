<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</title>
    <style>
        /* –°–±—Ä–æ—Å */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: #f8f9fa;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .container {
            max-width: 700px;
            width: 100%;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        /* –®–∞–ø–∫–∞ */
        .header {
            background: white;
            border-bottom: 1px solid #e9ecef;
            padding: 2rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .header p {
            color: #6c757d;
            font-size: 1em;
        }
        
        /* –ü–∞–Ω–µ–ª—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: #e9ecef;
            border-bottom: 1px solid #e9ecef;
        }
        
        .stat-box {
            background: white;
            padding: 1.5rem 1rem;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.85em;
            color: #6c757d;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: 700;
            color: #007bff;
        }
        
        .stat-value.time {
            color: #28a745;
        }
        
        .stat-value.time.warning {
            color: #ffc107;
            animation: pulse 0.5s infinite;
        }
        
        .stat-value.time.danger {
            color: #dc3545;
            animation: pulse 0.3s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã */
        .settings {
            padding: 2rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .settings-title {
            font-size: 1.2em;
            color: #2c3e50;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        
        .setting-group {
            margin-bottom: 1.5rem;
        }
        
        .setting-label {
            display: block;
            font-size: 0.95em;
            color: #495057;
            margin-bottom: 0.8rem;
            font-weight: 500;
        }
        
        .operation-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
        }
        
        .operation-btn {
            padding: 1rem;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.5em;
            font-weight: 600;
            color: #495057;
        }
        
        .operation-btn:hover {
            background: #e9ecef;
        }
        
        .operation-btn.active {
            background: #007bff;
            border-color: #007bff;
            color: white;
        }
        
        .difficulty-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }
        
        .difficulty-btn {
            padding: 1rem;
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            color: #495057;
        }
        
        .difficulty-btn:hover {
            background: #e9ecef;
        }
        
        .difficulty-btn.active {
            background: #28a745;
            border-color: #28a745;
            color: white;
        }
        
        .difficulty-btn.active.medium {
            background: #ffc107;
            border-color: #ffc107;
            color: #495057;
        }
        
        .difficulty-btn.active.hard {
            background: #dc3545;
            border-color: #dc3545;
            color: white;
        }
        
        /* –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å */
        .game-area {
            padding: 3rem 2rem;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .problem {
            font-size: 4em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 2rem;
            text-align: center;
            font-family: 'Courier New', monospace;
        }
        
        .answer-input {
            width: 250px;
            padding: 1.5rem;
            font-size: 2em;
            text-align: center;
            border: 3px solid #007bff;
            border-radius: 12px;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #0056b3;
            box-shadow: 0 0 0 4px rgba(0,123,255,0.1);
        }
        
        .answer-input.correct {
            border-color: #28a745;
            background: #d4edda;
            animation: correctShake 0.5s ease;
        }
        
        .answer-input.wrong {
            border-color: #dc3545;
            background: #f8d7da;
            animation: wrongShake 0.5s ease;
        }
        
        @keyframes correctShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .feedback {
            margin-top: 1.5rem;
            font-size: 1.5em;
            font-weight: 600;
            min-height: 40px;
            text-align: center;
        }
        
        .feedback.correct {
            color: #28a745;
        }
        
        .feedback.wrong {
            color: #dc3545;
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .actions {
            padding: 2rem;
            background: #f8f9fa;
            display: flex;
            gap: 1rem;
            border-top: 1px solid #e9ecef;
        }
        
        button {
            flex: 1;
            padding: 1rem 2rem;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-primary:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: white;
            color: #6c757d;
            border: 2px solid #6c757d;
        }
        
        .btn-secondary:hover {
            background: #6c757d;
            color: white;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            animation: modalShow 0.3s ease;
        }
        
        @keyframes modalShow {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .modal-icon {
            font-size: 5em;
            margin-bottom: 1rem;
        }
        
        .modal-title {
            font-size: 2em;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .modal-stats {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        
        .modal-stat-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 1.1em;
        }
        
        .modal-stat-label {
            color: #6c757d;
        }
        
        .modal-stat-value {
            font-weight: 700;
            color: #2c3e50;
        }
        
        .modal-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        /* –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤ */
        .records-table {
            width: 100%;
            margin-top: 1.5rem;
            border-collapse: collapse;
        }
        
        .records-table th,
        .records-table td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        .records-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            font-size: 0.9em;
            text-transform: uppercase;
        }
        
        .records-table td {
            color: #6c757d;
        }
        
        .records-table tr:hover {
            background: #f8f9fa;
        }
        
        .record-new {
            color: #28a745 !important;
            font-weight: 700;
        }
        
        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        .start-screen {
            text-align: center;
            padding: 3rem 2rem;
        }
        
        .start-icon {
            font-size: 5em;
            margin-bottom: 1rem;
        }
        
        .start-title {
            font-size: 1.8em;
            color: #2c3e50;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .start-description {
            color: #6c757d;
            font-size: 1.1em;
            margin-bottom: 2rem;
        }
        
        /* –°–∫—Ä—ã—Ç–æ */
        .hidden {
            display: none !important;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤ */
        @media (max-width: 768px) {
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .problem {
                font-size: 2.5em;
            }
            
            .answer-input {
                width: 200px;
                font-size: 1.5em;
            }
            
            .operation-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <h1>üßÆ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä</h1>
            <p>–¢—Ä–µ–Ω–∏—Ä—É–π—Ç–µ –Ω–∞–≤—ã–∫–∏ —É—Å—Ç–Ω–æ–≥–æ —Å—á—ë—Ç–∞</p>
        </div>
        
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-panel">
            <div class="stat-box">
                <div class="stat-label">–°—á—ë—Ç</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">–í–µ—Ä–Ω–æ</div>
                <div class="stat-value" id="correct">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">–û—à–∏–±–æ–∫</div>
                <div class="stat-value" id="wrong">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">–í—Ä–µ–º—è</div>
                <div class="stat-value time" id="timer">0:00</div>
            </div>
        </div>
        
        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div id="settingsScreen" class="settings">
            <div class="settings-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</div>
            
            <div class="setting-group">
                <label class="setting-label">–û–ø–µ—Ä–∞—Ü–∏–∏:</label>
                <div class="operation-buttons">
                    <div class="operation-btn active" onclick="toggleOperation('add')" data-op="add">+</div>
                    <div class="operation-btn" onclick="toggleOperation('sub')" data-op="sub">‚àí</div>
                    <div class="operation-btn active" onclick="toggleOperation('mul')" data-op="mul">√ó</div>
                    <div class="operation-btn" onclick="toggleOperation('div')" data-op="div">√∑</div>
                </div>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
                <div class="difficulty-buttons">
                    <div class="difficulty-btn active" onclick="selectDifficulty('easy')" data-diff="easy">
                        –õ–µ–≥–∫–æ<br><small>(1-10)</small>
                    </div>
                    <div class="difficulty-btn medium" onclick="selectDifficulty('medium')" data-diff="medium">
                        –°—Ä–µ–¥–Ω–µ<br><small>(1-50)</small>
                    </div>
                    <div class="difficulty-btn hard" onclick="selectDifficulty('hard')" data-diff="hard">
                        –°–ª–æ–∂–Ω–æ<br><small>(1-100)</small>
                    </div>
                </div>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤:</label>
                <div class="difficulty-buttons">
                    <div class="difficulty-btn active" onclick="selectProblems(10)" data-problems="10">10</div>
                    <div class="difficulty-btn" onclick="selectProblems(20)" data-problems="20">20</div>
                    <div class="difficulty-btn" onclick="selectProblems(30)" data-problems="30">30</div>
                </div>
            </div>
        </div>
        
        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="startScreen" class="start-screen">
            <div class="start-icon">üöÄ</div>
            <div class="start-title">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å?</div>
            <div class="start-description">
                –†–µ—à–∏—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ!
            </div>
            <button class="btn-success" onclick="startGame()" style="width: 250px; font-size: 1.3em;">
                –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É
            </button>
        </div>
        
        <!-- –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div id="gameScreen" class="game-area hidden">
            <div class="problem" id="problem">2 + 2 = ?</div>
            <input type="number" class="answer-input" id="answerInput" 
                   placeholder="?" autocomplete="off">
            <div class="feedback" id="feedback"></div>
        </div>
        
        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div id="actionsScreen" class="actions hidden">
            <button class="btn-secondary" onclick="skipProblem()">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
            <button class="btn-primary" onclick="checkAnswer()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <div class="modal-icon" id="resultsIcon">üéâ</div>
            <div class="modal-title" id="resultsTitle">–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!</div>
            
            <div class="modal-stats">
                <div class="modal-stat-row">
                    <span class="modal-stat-label">–ü—Ä–∏–º–µ—Ä–æ–≤ —Ä–µ—à–µ–Ω–æ:</span>
                    <span class="modal-stat-value" id="resultTotal">0</span>
                </div>
                <div class="modal-stat-row">
                    <span class="modal-stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤:</span>
                    <span class="modal-stat-value" id="resultCorrect">0</span>
                </div>
                <div class="modal-stat-row">
                    <span class="modal-stat-label">–û—à–∏–±–æ–∫:</span>
                    <span class="modal-stat-value" id="resultWrong">0</span>
                </div>
                <div class="modal-stat-row">
                    <span class="modal-stat-label">–¢–æ—á–Ω–æ—Å—Ç—å:</span>
                    <span class="modal-stat-value" id="resultAccuracy">0%</span>
                </div>
                <div class="modal-stat-row">
                    <span class="modal-stat-label">–í—Ä–µ–º—è:</span>
                    <span class="modal-stat-value" id="resultTime">0:00</span>
                </div>
                <div class="modal-stat-row">
                    <span class="modal-stat-label">–ò—Ç–æ–≥–æ–≤—ã–π —Å—á—ë—Ç:</span>
                    <span class="modal-stat-value" id="resultScore">0</span>
                </div>
            </div>
            
            <div id="recordMessage" class="hidden" style="color: #28a745; font-weight: 600; margin: 1rem 0;">
                üèÜ –ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥!
            </div>
            
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="showRecords()">–†–µ–∫–æ—Ä–¥—ã</button>
                <button class="btn-success" onclick="restartGame()">–ï—â—ë —Ä–∞–∑</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∫–æ—Ä–¥–æ–≤ -->
    <div id="recordsModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">üèÜ –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</div>
            
            <table class="records-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>–°—á—ë—Ç</th>
                        <th>–¢–æ—á–Ω–æ—Å—Ç—å</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–î–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody id="recordsTableBody">
                    <tr>
                        <td colspan="5" style="text-align: center; color: #adb5bd;">
                            –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <div class="modal-buttons">
                <button class="btn-secondary" onclick="clearRecords()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                <button class="btn-primary" onclick="closeRecordsModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        let selectedOperations = ['add', 'mul'];
        let difficulty = 'easy';
        let totalProblems = 10;
        
        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentProblem = null;
        let problemNumber = 0;
        let score = 0;
        let correctCount = 0;
        let wrongCount = 0;
        let startTime = null;
        let timerInterval = null;
        let gameActive = false;
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤
        function loadRecords() {
            const records = localStorage.getItem('math_records');
            return records ? JSON.parse(records) : [];
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞
        function saveRecord(record) {
            const records = loadRecords();
            records.push(record);
            records.sort((a, b) => b.score - a.score);
            records.splice(10); // –û—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ–ø-10
            localStorage.setItem('math_records', JSON.stringify(records));
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        function toggleOperation(op) {
            const btn = document.querySelector(`[data-op="${op}"]`);
            
            if (btn.classList.contains('active')) {
                if (selectedOperations.length > 1) {
                    btn.classList.remove('active');
                    selectedOperations = selectedOperations.filter(o => o !== op);
                }
            } else {
                btn.classList.add('active');
                selectedOperations.push(op);
            }
        }
        
        // –í—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        function selectDifficulty(diff) {
            difficulty = diff;
            document.querySelectorAll('[data-diff]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-diff="${diff}"]`).classList.add('active');
        }
        
        // –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–∏–º–µ—Ä–æ–≤
        function selectProblems(count) {
            totalProblems = count;
            document.querySelectorAll('[data-problems]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-problems="${count}"]`).classList.add('active');
        }
        
        // –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
        function startGame() {
            // –°–±—Ä–æ—Å
            problemNumber = 0;
            score = 0;
            correctCount = 0;
            wrongCount = 0;
            gameActive = true;
            
            // –û–±–Ω–æ–≤–∏—Ç—å UI
            updateStats();
            document.getElementById('settingsScreen').classList.add('hidden');
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('actionsScreen').classList.remove('hidden');
            
            // –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 100);
            
            // –ü–µ—Ä–≤—ã–π –ø—Ä–∏–º–µ—Ä
            nextProblem();
        }
        
        // –°–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–º–µ—Ä
        function nextProblem() {
            if (problemNumber >= totalProblems) {
                endGame();
                return;
            }
            
            problemNumber++;
            currentProblem = generateProblem();
            
            document.getElementById('problem').textContent = currentProblem.text;
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').className = 'answer-input';
            document.getElementById('feedback').textContent = '';
            document.getElementById('answerInput').focus();
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ—Ä–∞
        function generateProblem() {
            const operation = selectedOperations[Math.floor(Math.random() * selectedOperations.length)];
            let num1, num2, answer, text;
            
            const ranges = {
                easy: [1, 10],
                medium: [1, 50],
                hard: [1, 100]
            };
            
            const [min, max] = ranges[difficulty];
            
            switch(operation) {
                case 'add':
                    num1 = randomInt(min, max);
                    num2 = randomInt(min, max);
                    answer = num1 + num2;
                    text = `${num1} + ${num2} = ?`;
                    break;
                    
                case 'sub':
                    num1 = randomInt(min, max);
                    num2 = randomInt(min, num1);
                    answer = num1 - num2;
                    text = `${num1} ‚àí ${num2} = ?`;
                    break;
                    
                case 'mul':
                    const mulMax = difficulty === 'easy' ? 10 : difficulty === 'medium' ? 12 : 20;
                    num1 = randomInt(2, mulMax);
                    num2 = randomInt(2, mulMax);
                    answer = num1 * num2;
                    text = `${num1} √ó ${num2} = ?`;
                    break;
                    
                case 'div':
                    const divMax = difficulty === 'easy' ? 10 : difficulty === 'medium' ? 12 : 20;
                    num2 = randomInt(2, divMax);
                    num1 = num2 * randomInt(2, divMax);
                    answer = num1 / num2;
                    text = `${num1} √∑ ${num2} = ?`;
                    break;
            }
            
            return { answer, text, operation };
        }
        
        // –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç
        function checkAnswer() {
            if (!gameActive) return;
            
            const input = document.getElementById('answerInput');
            const userAnswer = parseFloat(input.value);
            const feedback = document.getElementById('feedback');
            
            if (isNaN(userAnswer)) {
                feedback.textContent = '–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ!';
                feedback.className = 'feedback wrong';
                return;
            }
            
            if (Math.abs(userAnswer - currentProblem.answer) < 0.01) {
                // –ü—Ä–∞–≤–∏–ª—å–Ω–æ
                correctCount++;
                score += calculatePoints();
                
                input.className = 'answer-input correct';
                feedback.textContent = '‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ!';
                feedback.className = 'feedback correct';
                
                updateStats();
                setTimeout(nextProblem, 800);
            } else {
                // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
                wrongCount++;
                
                input.className = 'answer-input wrong';
                feedback.textContent = `‚úó –ù–µ–≤–µ—Ä–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${currentProblem.answer}`;
                feedback.className = 'feedback wrong';
                
                updateStats();
                setTimeout(nextProblem, 1500);
            }
        }
        
        // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–º–µ—Ä
        function skipProblem() {
            if (!gameActive) return;
            wrongCount++;
            updateStats();
            nextProblem();
        }
        
        // –†–∞—Å—á—ë—Ç –æ—á–∫–æ–≤
        function calculatePoints() {
            const basePoints = {
                easy: 10,
                medium: 20,
                hard: 30
            };
            
            return basePoints[difficulty];
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('correct').textContent = correctCount;
            document.getElementById('wrong').textContent = wrongCount;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä
        function updateTimer() {
            const elapsed = Date.now() - startTime;
            const seconds = Math.floor(elapsed / 1000);
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            
            const display = `${minutes}:${secs.toString().padStart(2, '0')}`;
            const timerEl = document.getElementById('timer');
            timerEl.textContent = display;
            
            // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
            if (seconds > 120) {
                timerEl.classList.add('danger');
            } else if (seconds > 60) {
                timerEl.classList.add('warning');
            }
        }
        
        // –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É
        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            
            const elapsed = Date.now() - startTime;
            const seconds = Math.floor(elapsed / 1000);
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            const timeDisplay = `${minutes}:${secs.toString().padStart(2, '0')}`;
            
            const accuracy = Math.round((correctCount / totalProblems) * 100);
            
            // –ó–∞–ø–æ–ª–Ω–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('resultTotal').textContent = totalProblems;
            document.getElementById('resultCorrect').textContent = correctCount;
            document.getElementById('resultWrong').textContent = wrongCount;
            document.getElementById('resultAccuracy').textContent = accuracy + '%';
            document.getElementById('resultTime').textContent = timeDisplay;
            document.getElementById('resultScore').textContent = score;
            
            // –ò–∫–æ–Ω–∫–∞ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫
            if (accuracy >= 90) {
                document.getElementById('resultsIcon').textContent = 'üèÜ';
                document.getElementById('resultsTitle').textContent = '–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ!';
            } else if (accuracy >= 70) {
                document.getElementById('resultsIcon').textContent = 'üéâ';
                document.getElementById('resultsTitle').textContent = '–û—Ç–ª–∏—á–Ω–æ!';
            } else if (accuracy >= 50) {
                document.getElementById('resultsIcon').textContent = 'üëç';
                document.getElementById('resultsTitle').textContent = '–•–æ—Ä–æ—à–æ!';
            } else {
                document.getElementById('resultsIcon').textContent = 'üí™';
                document.getElementById('resultsTitle').textContent = '–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è!';
            }
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∫–æ—Ä–¥
            const record = {
                score: score,
                accuracy: accuracy,
                time: timeDisplay,
                date: new Date().toLocaleDateString('ru-RU'),
                timestamp: Date.now()
            };
            
            const records = loadRecords();
            const isNewRecord = records.length === 0 || score > records[0].score;
            
            if (isNewRecord) {
                document.getElementById('recordMessage').classList.remove('hidden');
            }
            
            saveRecord(record);
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.getElementById('resultsModal').classList.add('show');
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∫–æ—Ä–¥—ã
        function showRecords() {
            document.getElementById('resultsModal').classList.remove('show');
            
            const records = loadRecords();
            const tbody = document.getElementById('recordsTableBody');
            
            if (records.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; color: #adb5bd;">
                            –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π
                        </td>
                    </tr>
                `;
            } else {
                tbody.innerHTML = records.map((r, i) => `
                    <tr class="${i === 0 ? 'record-new' : ''}">
                        <td>${i + 1}</td>
                        <td>${r.score}</td>
                        <td>${r.accuracy}%</td>
                        <td>${r.time}</td>
                        <td>${r.date}</td>
                    </tr>
                `).join('');
            }
            
            document.getElementById('recordsModal').classList.add('show');
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∫–æ—Ä–¥–æ–≤
        function closeRecordsModal() {
            document.getElementById('recordsModal').classList.remove('show');
        }
        
        // –û—á–∏—Å—Ç–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã
        function clearRecords() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ä–µ–∫–æ—Ä–¥—ã?')) {
                localStorage.removeItem('math_records');
                showRecords();
            }
        }
        
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É
        function restartGame() {
            document.getElementById('resultsModal').classList.remove('show');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('actionsScreen').classList.add('hidden');
            document.getElementById('settingsScreen').classList.remove('hidden');
            document.getElementById('startScreen').classList.remove('hidden');
            
            // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞
            document.getElementById('timer').textContent = '0:00';
            document.getElementById('timer').className = 'stat-value time';
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter
        document.getElementById('answerInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && gameActive) {
                checkAnswer();
            }
        });
    </script>
</body>
</html>